function J = nonlin_jacobian(x, u)

b=0;
K1=0;
K3=0;
K4=0;
f_u=0;

if u < 0
    %omega_ref = 6659*x^4 + 1.083*10000 *x^3 + 6343 * x * x +1888*x - 1.157;
    b = 0.239927543450809;
    K1 = -10.548800723683954;
    K3 = 5.498506290874219e-05;
    K4 = 4.594429729616914;
    f_u = 272.9 * u * u + 593.4 * u - 8.529;
else
    %omega_ref = -1.905*100000*x^4 + 1.299*100000*x^3 - 3.225*10000 * x *x + 4233*x + 0.7921;
    b = 0.025936940902745;
    K1 = -10.577796958770156;
    K3 = -2.433475804656021e-05;
    K4 = 5.379206715771331;
    f_u = -284.3 * u * u + 609 * u + 7.086;
end

J = [0, 1, 0; -K1*cos(x(1)), b, 2*K3*x(3); 0, 0, -K4 +K2*K4];

end